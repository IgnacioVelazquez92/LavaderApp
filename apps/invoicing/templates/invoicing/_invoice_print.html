{# apps/invoicing/templates/invoicing/_invoice_print.html #}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Remito {{ snapshot.comprobante.numero }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    /* Reglas mínimas para impresión (blanco/negro) */
    @page { margin: 18mm; }
    body { font-family: Arial, Helvetica, sans-serif; font-size: 12px; color: #000; }
    .table { width: 100%; border-collapse: collapse; }
    .table th, .table td { border: 1px solid #000; padding: 6px 8px; vertical-align: top; }
    .table thead th { font-weight: 700; }
    .no-border td, .no-border th { border: 0 !important; }
    .small { font-size: 11px; }
    .xsmall { font-size: 10px; }
    .h-title { font-size: 22px; font-weight: 700; letter-spacing: 1px; }
    .muted { color: #333; }
    .tight td, .tight th { padding: 4px 6px; }
    .w-10 { width: 10%; }
    .w-20 { width: 20%; }
    .w-30 { width: 30%; }
    .w-40 { width: 40%; }
    .w-50 { width: 50%; }
    .w-60 { width: 60%; }
    .text-right { text-align: right; }
    .text-center { text-align: center; }
    .text-uppercase { text-transform: uppercase; }
    .mb-0 { margin-bottom: 0; }
    .mb-1 { margin-bottom: .25rem; }
    .mb-2 { margin-bottom: .5rem; }
    .mb-3 { margin-bottom: 1rem; }
    .mt-2 { margin-top: .5rem; }
    .mt-3 { margin-top: 1rem; }
    .p-0 { padding: 0; }
    .pt-2 { padding-top: .5rem; }
    .pb-1 { padding-bottom: .25rem; }
    .fw-bold { font-weight: 700; }
    .border { border: 1px solid #000; }
    .border-0 { border: 0; }
    .rounded { border-radius: 4px; }
    .row { display: flex; flex-wrap: nowrap; gap: 16px; }
    .col { flex: 1 1 0; }
    .col-auto { flex: 0 0 auto; }
    .logo-box { width: 120px; height: 60px; border: 1px solid #000; display: flex; align-items: center; justify-content: center; }
    .checkbox { display:inline-block; width: 12px; height: 12px; border: 1px solid #000; margin-right: 6px; vertical-align: middle; }
    /* Evitar cortes feos en tabla */
    .avoid-break { page-break-inside: avoid; }
  </style>
</head>
<body>

  {# ENCABEZADO #}
  <table class="table no-border mb-3">
    <tr>
      <td class="border-0 align-top w-40">
        <div class="row">
          <div class="col-auto">
            {# Logo: si no hay, mostramos caja vacía #}
            {% if snapshot.empresa.logo_data %}
              <img src="{{ snapshot.empresa.logo_data }}" alt="Logo" style="width:120px; height:auto;">
            {% else %}
              <div class="logo-box xsmall">LOGO</div>
            {% endif %}
          </div>
          <div class="col">
            <div class="fw-bold">{{ snapshot.empresa.nombre }}</div>
            <div class="small muted">
              {{ snapshot.sucursal.nombre }}<br>
              {{ snapshot.sucursal.direccion|default:"" }}
            </div>
          </div>
        </div>
      </td>
      <td class="border-0 align-top text-right w-60">
        <div class="h-title text-uppercase">
          {{ snapshot.comprobante.tipo }}
        </div>
        <div class="xsmall muted">
          {% if snapshot.comprobante.tipo == "REMITO" %}
            DOCUMENTO NO VÁLIDO COMO FACTURA
          {% else %}
            DOCUMENTO NO FISCAL
          {% endif %}
        </div>
        <div class="mt-2">
          <div class="fw-bold">
            Nº {{ snapshot.comprobante.numero }}
          </div>
          <div class="small">
            Fecha: {{ snapshot.comprobante.emitido_en|slice:":10" }}
          </div>
          <div class="small">
            Punto de venta: {{ snapshot.sucursal.punto_venta }}
          </div>
        </div>
      </td>
    </tr>
  </table>

  {# DATOS DEL CLIENTE #}
  <table class="table tight mb-3">
    <thead>
      <tr>
        <th colspan="4">Datos del Cliente</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="w-40">
          <div class="small muted">Nombre / Razón Social</div>
          <div>{{ snapshot.cliente.nombre }} {% if snapshot.cliente.apellido %}{{ snapshot.cliente.apellido }}{% endif %}</div>
        </td>
        <td class="w-30">
          <div class="small muted">Domicilio</div>
          <div>{{ snapshot.cliente.domicilio|default:"—" }}</div>
        </td>
        <td class="w-20">
          <div class="small muted">Localidad</div>
          <div>{{ snapshot.cliente.localidad|default:"—" }}</div>
        </td>
        <td class="w-10">
          <div class="small muted">CUIT</div>
          <div>{{ snapshot.cliente.cuit|default:"—" }}</div>
        </td>
      </tr>
      <tr>
        <td class="w-40">
          <div class="small muted">IVA</div>
          <div>{{ snapshot.cliente.iva|default:"Consumidor Final" }}</div>
        </td>
        <td class="w-30">
          <div class="small muted">Vehículo</div>
          <div>{{ snapshot.vehiculo.patente|default:"—" }}{% if snapshot.vehiculo.tipo %} — {{ snapshot.vehiculo.tipo }}{% endif %}</div>
        </td>
        <td class="w-20">
          <div class="small muted">Venta</div>
          <div>{{ snapshot.venta.id }}</div>
        </td>
        <td class="w-10">
          <div class="small muted">Moneda</div>
          <div>{{ snapshot.comprobante.moneda }}</div>
        </td>
      </tr>
    </tbody>
  </table>

  {# CONDICIONES DE VENTA #}
  <table class="table tight mb-3">
    <thead>
      <tr>
        <th>Condiciones de venta</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>
          <span class="checkbox"></span> Contado
          &nbsp;&nbsp;&nbsp;
          <span class="checkbox"></span> Cta. Cte.
          &nbsp;&nbsp;&nbsp;
          <span class="checkbox"></span> Factura Nº ______________________
        </td>
      </tr>
    </tbody>
  </table>

  {# DETALLE DE SERVICIOS / PRODUCTOS #}
  <table class="table mb-0 avoid-break">
    <thead>
      <tr>
        <th class="w-15 text-center">CANTIDAD</th>
        <th class="w-55">DESCRIPCIÓN</th>
        <th class="w-15 text-right">PARCIAL</th>
        <th class="w-15 text-right">TOTAL</th>
      </tr>
    </thead>
    <tbody>
      {% for it in snapshot.items %}
        <tr>
          <td class="text-center">
            {% if it.cantidad %}{{ it.cantidad }}{% else %}1{% endif %}
          </td>
          <td>
            {{ it.servicio_nombre }}
          </td>
          <td class="text-right">
            {{ it.precio_unitario }}
          </td>
          <td class="text-right">
            {{ it.subtotal }}
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="4" class="text-center">— Sin ítems —</td>
        </tr>
      {% endfor %}
    </tbody>
    <tfoot>
      <tr>
        <td colspan="2" class="text-right fw-bold">Subtotal</td>
        <td colspan="2" class="text-right">{{ snapshot.venta.subtotal }}</td>
      </tr>
      {% if snapshot.venta.descuento and snapshot.venta.descuento != "0.00" %}
      <tr>
        <td colspan="2" class="text-right fw-bold">Descuento</td>
        <td colspan="2" class="text-right">-{{ snapshot.venta.descuento }}</td>
      </tr>
      {% endif %}
      {% if snapshot.venta.propina and snapshot.venta.propina != "0.00" %}
      <tr>
        <td colspan="2" class="text-right fw-bold">Propina</td>
        <td colspan="2" class="text-right">{{ snapshot.venta.propina }}</td>
      </tr>
      {% endif %}
      <tr>
        <td colspan="2" class="text-right fw-bold">TOTAL</td>
        <td colspan="2" class="text-right fw-bold">{{ snapshot.venta.total }}</td>
      </tr>
    </tfoot>
  </table>

  {# PIE: observaciones y leyendas #}
  <table class="table no-border mt-3">
    <tr>
      <td class="border-0 align-top w-60">
        <div class="small muted">Observaciones</div>
        <div class="border rounded p-0" style="min-height: 56px;"></div>
      </td>
      <td class="border-0 align-top w-40">
        <div class="xsmall muted">{{ snapshot.leyendas.no_fiscal }}</div>
      </td>
    </tr>
  </table>

  <table class="table no-border mt-3">
    <tr>
      <td class="border-0 text-center">
        <div class="border rounded" style="height: 48px;"></div>
        <div class="xsmall">Entregué conforme</div>
      </td>
      <td class="border-0 text-center">
        <div class="border rounded" style="height: 48px;"></div>
        <div class="xsmall">Recibí conforme</div>
      </td>
    </tr>
  </table>

</body>
</html>
