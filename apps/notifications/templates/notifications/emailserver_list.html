{% extends "base_auth.html" %}
{% load i18n %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h4">{% trans "Servidores SMTP" %}</h1>
  {% if puede_crear %}
    <a href="{% url 'notifications:emailserver_create' %}" class="btn btn-primary">
      {% trans "Nuevo servidor" %}
    </a>
  {% endif %}
</div>

<table class="table table-sm align-middle">
  <thead>
    <tr>
      <th>{% trans "Nombre" %}</th>
      <th>{% trans "Host" %}</th>
      <th>{% trans "Puerto" %}</th>
      <th>{% trans "TLS" %}</th>
      <th>{% trans "SSL" %}</th>
      <th>{% trans "Activo" %}</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {% for it in items %}
      <tr>
        <td>{{ it.nombre }}</td>
        <td>{{ it.host }}</td>
        <td>{{ it.port }}</td>
        <td>{{ it.use_tls|yesno:"Sí,No" }}</td>
        <td>{{ it.use_ssl|yesno:"Sí,No" }}</td>
        <td>{{ it.activo|yesno:"Sí,No" }}</td>
        <td class="text-end">
          {% if puede_editar %}
            <a href="{% url 'notifications:emailserver_update' it.pk %}" class="btn btn-outline-secondary btn-sm">
              {% trans "Editar" %}
            </a>
          {% endif %}
          {% if puede_testear %}
            <a href="{% url 'notifications:emailserver_test' it.pk %}" class="btn btn-outline-info btn-sm">
              {% trans "Probar" %}
            </a>
          {% endif %}
          {% if puede_eliminar %}
            <!-- Botón que abre modal -->
            <button type="button" class="btn btn-outline-danger btn-sm"
                    data-bs-toggle="modal" data-bs-target="#deleteModal{{ it.pk }}">
              {% trans "Eliminar" %}
            </button>

            <!-- Modal de confirmación -->
            <div class="modal fade" id="deleteModal{{ it.pk }}" tabindex="-1" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">{% trans "Confirmar eliminación" %}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{% trans 'Cerrar' %}"></button>
                  </div>
                  <div class="modal-body">
                    <p>
                      {% blocktrans with nombre=it.nombre %}
                        ¿Estás seguro de que querés eliminar el servidor <strong>{{ nombre }}</strong>?
                      {% endblocktrans %}
                    </p>
                  </div>
                  <div class="modal-footer">
                    <form method="post" action="{% url 'notifications:emailserver_delete' it.pk %}">
                      {% csrf_token %}
                      <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                        {% trans "Cancelar" %}
                      </button>
                      <button type="submit" class="btn btn-danger">
                        {% trans "Eliminar" %}
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          {% endif %}
        </td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="7" class="text-center text-muted">
          {% trans "No hay configuraciones SMTP cargadas." %}
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
