{% extends "base_auth.html" %}
{% block title %}{{ obj.display_name }}{% endblock %}

{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3">
  <h1 class="h4 mb-0">{{ obj.display_name }}</h1>
  <a href="{% url 'customers:update' obj.pk %}" class="btn btn-outline-secondary">Editar</a>
</div>

<div class="row g-3">
  <div class="col-md-6">
    <div class="card h-100">
      <div class="card-header">Datos básicos</div>
      <div class="card-body">
        <dl class="row mb-0">
          <dt class="col-sm-4">Tipo</dt>
          <dd class="col-sm-8">{{ obj.get_tipo_persona_display }}</dd>

          <dt class="col-sm-4">Documento</dt>
          <dd class="col-sm-8">{{ obj.documento|default:"—" }}</dd>

          <dt class="col-sm-4">Email</dt>
          <dd class="col-sm-8">{{ obj.email|default:"—" }}</dd>

          <dt class="col-sm-4">Teléfono</dt>
          <dd class="col-sm-8">{{ obj.tel_wpp|default:"—" }}</dd>

          <dt class="col-sm-4">Fecha nac.</dt>
          <dd class="col-sm-8">
            {% if obj.fecha_nac %}
              {{ obj.fecha_nac }} ({{ obj.edad }} años)
            {% else %}
              —
            {% endif %}
          </dd>

          <dt class="col-sm-4">Estado</dt>
          <dd class="col-sm-8">{{ obj.activo|yesno:"Activo,Inactivo" }}</dd>
        </dl>
      </div>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card h-100">
      <div class="card-header">Ubicación</div>
      <div class="card-body">
        <dl class="row mb-0">
          <dt class="col-sm-4">Dirección</dt>
          <dd class="col-sm-8">{{ obj.direccion|default:"—" }}</dd>
          <dt class="col-sm-4">Localidad</dt>
          <dd class="col-sm-8">{{ obj.localidad|default:"—" }}</dd>
          <dt class="col-sm-4">Provincia</dt>
          <dd class="col-sm-8">{{ obj.provincia|default:"—" }}</dd>
          <dt class="col-sm-4">CP</dt>
          <dd class="col-sm-8">{{ obj.cp|default:"—" }}</dd>
        </dl>
      </div>
    </div>
  </div>
</div>

{% if obj.notas %}
<div class="card mt-3">
  <div class="card-header">Notas</div>
  <div class="card-body">
    <p class="mb-0">{{ obj.notas }}</p>
  </div>
</div>
{% endif %}

{# Placeholder: vehículos asociados (futuro módulo vehicles) #}
{# Vehículos del cliente #}
<div class="card mt-3 shadow-sm">
  <div class="card-header d-flex align-items-center justify-content-between">
    <span class="fw-semibold">Vehículos</span>
    <a
      href="{% url 'vehicles:new' %}?cliente={{ obj.pk }}&next={{ request.get_full_path|urlencode }}"
      class="btn btn-sm btn-primary"
    >
      <i class="bi bi-plus-lg"></i> Agregar vehículo
    </a>
  </div>

  {% if vehiculos %}
    <div class="table-responsive">
      <table class="table align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th scope="col">Patente</th>
            <th scope="col" class="d-none d-md-table-cell">Tipo</th>
            <th scope="col">Marca / Modelo</th>
            <th scope="col" class="d-none d-lg-table-cell">Año</th>
            <th scope="col" class="text-center">Estado</th>
            <th scope="col" class="text-end">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for v in vehiculos %}
          <tr>
            <td>
              <a href="{% url 'vehicles:detail' v.pk %}" class="text-decoration-none fw-semibold">
                {{ v.patente }}
              </a>
              {% if v.color %}
                <span class="badge rounded-pill text-bg-light border ms-1">{{ v.color }}</span>
              {% endif %}
            </td>
            <td class="d-none d-md-table-cell">{{ v.tipo.nombre|default:"—" }}</td>
            <td>
              {% if v.marca or v.modelo %}
                {{ v.marca|default:"" }}{% if v.marca and v.modelo %} {% endif %}{{ v.modelo|default:"" }}
              {% else %}
                <span class="text-body-secondary">—</span>
              {% endif %}
            </td>
            <td class="d-none d-lg-table-cell">{{ v.anio|default:"—" }}</td>
            <td class="text-center">
              {% if v.activo %}
                <span class="badge text-bg-success">Activo</span>
              {% else %}
                <span class="badge text-bg-secondary">Inactivo</span>
              {% endif %}
            </td>
            <td class="text-end">
              <div class="btn-group btn-group-sm" role="group" aria-label="Acciones">
                <a
                  class="btn btn-outline-primary"
                  href="{% url 'vehicles:edit' v.pk %}?next={{ request.get_full_path|urlencode }}"
                >
                  <i class="bi bi-pencil-square"></i> Editar
                </a>

                {% if v.activo %}
                  <form method="post" action="{% url 'vehicles:deactivate' v.pk %}" class="d-inline">
                    {% csrf_token %}
                    <input type="hidden" name="next" value="{{ request.get_full_path }}">
                    <button type="submit" class="btn btn-outline-danger" data-bs-toggle="tooltip" data-bs-title="Desactivar">
                      <i class="bi bi-slash-circle"></i>
                    </button>
                  </form>
                {% else %}
                  <form method="post" action="{% url 'vehicles:activate' v.pk %}" class="d-inline">
                    {% csrf_token %}
                    <input type="hidden" name="next" value="{{ request.get_full_path }}">
                    <button type="submit" class="btn btn-outline-success" data-bs-toggle="tooltip" data-bs-title="Activar">
                      <i class="bi bi-check-circle"></i>
                    </button>
                  </form>
                {% endif %}
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="card-body text-body-secondary d-flex align-items-center">
      <i class="bi bi-car-front fs-4 me-2"></i>
      <div>
        <div class="fw-semibold">Sin vehículos registrados</div>
        <div>Agregá el primero para asociarlo a ventas y servicios.</div>
      </div>
    </div>
  {% endif %}
</div>

{% endblock %}
